{"version":3,"sources":["sci/impl/multimethods.cljc"],"mappings":"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","names":["var_args","args__4795__auto__","len__4789__auto__","i__4790__auto__","argseq__4796__auto__","cljs.core/IndexedSeq","sci.impl.multimethods/check-valid-options","seq46962","G__46963","cljs.core/first","cljs.core/next","self__4776__auto__","options","valid-keys","cljs.core/seq","cljs.core.apply.cljs$core$IFn$_invoke$arity$3","cljs.core/disj","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-set","cljs.core/keys","js/Error","cljs.core.apply.cljs$core$IFn$_invoke$arity$4","cljs.core/str","p1__46961#","cljs.core.map.cljs$core$IFn$_invoke$arity$2","cljs.core/rest","sci.impl.multimethods/defmulti","seq46986","G__46987","G__46988","G__46989","G__46990","_","ctx","mm-name","docstring","m","cljs.core/map?","dispatch-fn","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.core/meta","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","cljs.core/with-meta","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/count","cljs.core.sequence.cljs$core$IFn$_invoke$arity$1","cljs.core.concat.cljs$core$IFn$_invoke$arity$variadic","cljs.core/List","cljs.core/vec","cljs.core.concat.cljs$core$IFn$_invoke$arity$2","cljs.core/array-map","cljs.core.concat.cljs$core$IFn$_invoke$arity$0","cljs.core/hash-map","default","cljs.core.get.cljs$core$IFn$_invoke$arity$3","hierarchy","sci.impl.hierarchies/global-hierarchy","sci.impl.multimethods.check_valid_options.cljs$core$IFn$_invoke$arity$variadic","cljs.core.symbol.cljs$core$IFn$_invoke$arity$1","cljs.core/name","sci.impl.multimethods/multi-fn?-impl","x","cljs.core/MultiFn","sci.impl.multimethods/multi-fn-impl","name","method-table","prefer-table","method-cache","cached-hierarchy","sci.impl.multimethods/multi-fn-add-method-impl","multifn","dispatch-val","f","cljs.core/-add-method","sci.impl.multimethods/defmethod","seq47023","G__47024","G__47025","G__47026","G__47027","fn-tail"],"sourcesContent":["(ns sci.impl.multimethods\n  {:no-doc true}\n  (:refer-clojure :exclude [defmulti defmethod])\n  (:require [sci.impl.hierarchies :refer [global-hierarchy]]))\n\n(defn ^:private check-valid-options\n  \"Throws an exception if the given option map contains keys not listed\n  as valid, else returns nil.\"\n  [options & valid-keys]\n  (when (seq (apply disj (apply hash-set (keys options)) valid-keys))\n    (throw\n     (new #?(:clj IllegalArgumentException :cljs js/Error)\n          (apply str \"Only these options are valid: \"\n                 (first valid-keys)\n                 (map #(str \", \" %) (rest valid-keys)))))))\n\n(defn defmulti\n  \"Creates a new multimethod with the associated dispatch function.\n  The docstring and attr-map are optional.\n\n  Options are key-value pairs and may be one of:\n\n  :default\n\n  The default dispatch value, defaults to :default\n\n  :hierarchy\n\n  The value used for hierarchical dispatch (e.g. ::square is-a ::shape)\n\n  Hierarchies are type-like relationships that do not depend upon type\n  inheritance. By default Clojure's multimethods dispatch off of a\n  global hierarchy map.  However, a hierarchy relationship can be\n  created with the derive function used to augment the root ancestor\n  created with make-hierarchy.\n\n  Multimethods expect the value of the hierarchy option to be supplied as\n  a reference type e.g. a var (i.e. via the Var-quote dispatch macro #'\n  or the var special form).\"\n  {:arglists '([name docstring? attr-map? dispatch-fn & options])}\n  [_ _ ctx mm-name & options]\n  (let [docstring   (if (string? (first options))\n                      (first options)\n                      nil)\n        options     (if (string? (first options))\n                      (next options)\n                      options)\n        m           (if (map? (first options))\n                      (first options)\n                      {})\n        options     (if (map? (first options))\n                      (next options)\n                      options)\n        dispatch-fn (first options)\n        options     (next options)\n        m           (if docstring\n                      (assoc m :doc docstring)\n                      m)\n        m           (if (meta mm-name)\n                      (conj (meta mm-name) m)\n                      m)\n        mm-name (with-meta mm-name m)]\n    (when (= (count options) 1)\n      (throw (new #?(:clj Exception :cljs js/Error)\n                  \"The syntax for defmulti has changed. Example: (defmulti name dispatch-fn :default dispatch-value)\")))\n\n    (let [options   (apply hash-map options)\n          default   (get options :default :default)\n          hierarchy (get options :hierarchy (global-hierarchy ctx))]\n      (check-valid-options options :default :hierarchy)\n      #?(:clj `(let [v# (def ~mm-name)]\n                 (when-not (and (clojure.core/has-root-impl v#) (clojure.core/multi-fn?-impl (deref v#)))\n                   (def ~mm-name\n                     (clojure.core/multi-fn-impl ~(name mm-name) ~dispatch-fn ~default ~hierarchy))))\n         :cljs `(defonce ~(with-meta mm-name m)\n                  (let [method-table# (atom {})\n                        prefer-table# (atom {})\n                        method-cache# (atom {})\n                        cached-hierarchy# (atom {})]\n                    (clojure.core/multi-fn-impl ~(symbol (name mm-name)) ~dispatch-fn ~default ~hierarchy\n                                                method-table# prefer-table# method-cache# cached-hierarchy#)))))))\n\n(defn multi-fn?-impl [x]\n  (instance? #?(:clj clojure.lang.MultiFn\n                :cljs cljs.core/MultiFn) x))\n\n(defn multi-fn-impl #?(:clj [name dispatch-fn default hierarchy]\n                       :cljs [name dispatch-fn default hierarchy\n                              method-table prefer-table method-cache cached-hierarchy])\n  (new #?(:clj clojure.lang.MultiFn\n          :cljs cljs.core/MultiFn) name dispatch-fn default hierarchy\n       #?@(:cljs [method-table prefer-table method-cache cached-hierarchy])))\n\n(defn multi-fn-add-method-impl\n  [multifn dispatch-val f]\n  #?(:clj (.addMethod ^clojure.lang.MultiFn multifn dispatch-val f)\n     :cljs (-add-method multifn dispatch-val f)))\n\n(defn defmethod\n  \"Creates and installs a new method of multimethod associated with dispatch-value. \"\n  [_ _ multifn dispatch-val & fn-tail]\n  `(clojure.core/multi-fn-add-method-impl ~multifn ~dispatch-val (fn ~@fn-tail)))\n"]}