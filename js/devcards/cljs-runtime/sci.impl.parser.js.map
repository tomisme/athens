{"version":3,"sources":["sci/impl/parser.cljc"],"mappings":";;;;;;AAWA,AAAKA,AACH,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAACC;AAQH,AAAA,AAAMC,AAAeC,AAAIC;AAAzB,AACE,AAAA,AAAAC,AAAMC,AAAK,AAAA,AAAMH;AACXI,AAAO,AAAAC,AAAa,AAACE,AAAUN;AAAxB,AAAA,AAAAI;AAAA,AAAA,AAAAA,AAAWC;AAAX,AACE,AAACE,AAAOF;;AADV;;;AAEPG,AAAa,AAACC,AAAKT;AACnBU,AAAW,AAACC;AACZC,AAAe,AAAKF;AACpBG,AAAW,AAAA,AAACC,AAAIZ;AAChBa,AAAe,AAACD,AAAID,AAAWH;AAC/BM,AAAQ,AAAA,AAAUD;AAClBE,AAAI,AAAA,AAAAC,AAAQf,AACN,AAAAgB,AAAI,AAAM,AAAAA,AAAI,AAACL,AAAI,AAAA,AAAA,AAACA,AAAID,AAA0Bb;AAAxC,AAAA,AAAAmB;AAAAA;;AACI,AAACC,AAAUC,AAAWrB;;AADhC,AAAA,AAEE,AAAA,AAACsB,AAAsBd;AAF7B,AAAA,AAAAW;AAAAA;;AAAA,AAAAA,AAGI,AAACI,AAA4BxB,AAAIC;AAHrC,AAAA,AAAAmB;AAAAA;;AAII,AAACG,AAAOV,AAAeJ;;;AAC3B,AAAI,AAAA,AAAA,AAACgB,AAAOtB,AAAiBC,AAC3BH,AACA,AAAAyB,AAAY,AAACX,AAAIE,AAAQb;AAAzB,AAAA,AAAAsB;AAAA,AAAAA,AAASC;AAAT,AACE,AAACJ,AAAO,AAAKI,AAAIlB;;AACjBR;;;AAnBhB,AAoBEiB;;AAEJ,AAAA,AAAA,AAAAU,AAAME;AAAN,AAAA,AAAAD,AAAA,AAAA;AAAA,AAAA,AAAAA;AAAA;AAAA,AAAAC,AAAA,AAAA,AAAA;;;AAAA;AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA;;;;AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA;;;;;AAAA,AAAA,AAAA,AAAMD,AACFE;AADJ,AAEG,AAACC,AAAkBpC,AAAKmC;;;AAF3B,AAAA,AAAA,AAAMF,AAGF9B,AAAIgC;AAHR,AAIG,AAAME,AAAS,AAAA,AAAWlC;AACpBmC,AAAQ,AAAA,AAAUnC;AAClBG,AAAI,AAAA,AAAMH;AAFhB,AAAAE,AAGMkC,AAASjC;AACTQ,AAAW,AAACC;AACZI,AAAe,AAAA,AAAA,AAACS,AAAOW,AAAqBzB;AAC5CM,AAAQ,AAAA,AAAUD;AAClBqB,AAAa,AAAA,AAACC,AAAMrB,AACSN;AAC7B4B,AAAW,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAC,AAACC,AAAM5C,AAEUqC,AACIG;AAHrB,AAIuC,AAAAG,AAACzC,AAAcC;AAJtD,AAAA,AAAA,AAKoCmC;AAC/CjB,AAAI,AAACe,AAAkBM,AACAP;AAhB7B,AAkBEd;;;AAtBL,AAAA,AAAA,AAAMY;;AAAN,AA0BA","names":["sci.impl.parser/opts","edamame.impl.parser/normalize-opts","sci.impl.parser/fully-qualify","ctx","sym","cljs.core/deref","env","sym-ns","temp__5735__auto__","n","cljs.core/namespace","cljs.core.symbol.cljs$core$IFn$_invoke$arity$1","sym-name-str","cljs.core/name","current-ns","sci.impl.vars/current-ns-name","current-ns-str","namespaces","cljs.core.get.cljs$core$IFn$_invoke$arity$2","the-current-ns","aliases","ret","cljs.core/not","or__4185__auto__","cljs.core/contains?","sci.impl.analyzer/macros","cljs.core.symbol.cljs$core$IFn$_invoke$arity$2","sci.impl.interop/fully-qualify-class","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","temp__5733__auto__","ns","var_args","G__59144","sci.impl.parser/parse-next","js/Error","r","edamame.impl.parser/parse-next","features","readers","env-val","auto-resolve","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","parse-opts","p1__59141#","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic"],"sourcesContent":["(ns sci.impl.parser\n  {:no-doc true}\n  (:refer-clojure :exclude [read-string])\n  (:require\n   [edamame.impl.parser :as parser]\n   [sci.impl.analyzer :as ana]\n   [sci.impl.interop :as interop]\n   [sci.impl.vars :as vars]))\n\n#?(:clj (set! *warn-on-reflection* true))\n\n(def opts\n  (parser/normalize-opts\n   {:all true\n    :read-eval false\n    :row-key :line\n    :col-key :column\n    :end-row-key :end-line\n    :end-col-key :end-column}))\n\n(defn fully-qualify [ctx sym]\n  (let [env @(:env ctx)\n        sym-ns (when-let [n (namespace sym)]\n                 (symbol n))\n        sym-name-str (name sym)\n        current-ns (vars/current-ns-name)\n        current-ns-str (str current-ns)\n        namespaces (get env :namespaces)\n        the-current-ns (get namespaces current-ns)\n        aliases (:aliases the-current-ns)\n        ret (if-not sym-ns\n              (or (when (or (get (get namespaces 'clojure.core) sym)\n                            (contains? ana/macros sym))\n                    (symbol \"clojure.core\" sym-name-str))\n                  (interop/fully-qualify-class ctx sym)\n                  (symbol current-ns-str sym-name-str))\n              (if (get-in env [:namespaces sym-ns])\n                sym\n                (if-let [ns (get aliases sym-ns)]\n                  (symbol (str ns) sym-name-str)\n                  sym)))]\n    ret))\n\n(defn parse-next\n  ([r]\n   (parser/parse-next opts r))\n  ([ctx r]\n   (let [features (:features ctx)\n         readers (:readers ctx)\n         env (:env ctx)\n         env-val @env\n         current-ns (vars/current-ns-name)\n         the-current-ns (get-in env-val [:namespaces current-ns])\n         aliases (:aliases the-current-ns)\n         auto-resolve (assoc aliases\n                             :current current-ns)\n         parse-opts (assoc opts\n                           :read-cond :allow\n                           :features features\n                           :auto-resolve auto-resolve\n                           :syntax-quote {:resolve-symbol #(fully-qualify ctx %)}\n                           :tools.reader/opts {:readers readers})\n         ret (parser/parse-next parse-opts\n                                r)]\n     ;; (prn \"ret\" ret)\n     ret)))\n\n;;;; Scratch\n\n(comment\n  )\n"]}