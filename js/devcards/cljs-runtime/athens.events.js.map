{"version":3,"sources":["athens/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","day8.re-frame.tracing/is-trace-enabled?","+debux-dbg-opts+","debux.common.util/send-form!","opts__46535__auto__","result__46536__auto__","debux.common.util/send-trace!","e","e60296","_","athens.db/rfdb","db","cljs.core.update.cljs$core$IFn$_invoke$arity$3","cljs.core/not","p__60297","vec__60298","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","G__60303","fexpr__60302","e60301","p__60304","vec__60305","selected-page","fexpr__60308","cljs.core/set","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core/conj","p__60309","vec__60310","item","cljs.core.update_in.cljs$core$IFn$_invoke$arity$3","p__60313","vec__60314","uid","cljs.core/dissoc","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$2","p__60317","p__60318","map__60319","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","vec__60320","G__60325","cljs.core/deref","G__60326","G__60327","e60324","p__60328","p__60329","map__60330","vec__60331","block","G__60335","G__60336","G__60337","datascript.core/pull","athens.db/dsdb","new-item","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","new-items","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","inc-items","cljs.core/reduce-kv","m","k","v","cljs.core/inc","sorted-items","cljs.core.into.cljs$core$IFn$_invoke$arity$2","cljs.core/sorted-map-by","k1","k2","cljs.core/compare","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","e60338","alert","e60339","e60340","cljs.core/assoc-in","e60341","athens.events/focus-el","id","temp__5733__auto__","el","js/document","p__60342","vec__60343","e60346","e60347","p__60348","vec__60349","js/setTimeout","p__60352","vec__60353","p__60356","p__60357","map__60358","vec__60359","map__60362","title","new-db","athens.db/e-by-av","p__60365","map__60366","rfdb","athens.db/athens-url","p__60368","vec__60369","json-str","datoms","athens.db/str-to-db-tx","datascript.core/db-with","datascript.core/empty-db","athens.db/schema","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$3","G__60372","G__60373","re-frame.core/inject-cofx","p__60374","map__60375","local-storage","datascript.transit/read-transit-str","p__60377","vec__60378","p__60381","vec__60382","p__60385","vec__60386","p__60389","vec__60390","now","athens.util/now-ts","child-uid","athens.util/gen-block-uid","child","temp__5735__auto__","prev","p1__60393#","athens.db/find-prev","athens.db/history","next","p1__60394#","athens.db/find-next","athens.events/rules","athens.events/map-order","blocks","cljs.core.map.cljs$core$IFn$_invoke$arity$2","p__60395","vec__60396","order","athens.events/inc-after","eid","G__60399","G__60400","G__60401","G__60402","G__60403","datascript.core/q","athens.events/dec-after","G__60404","G__60405","G__60406","G__60407","G__60408","athens.events/prev-sibling-uid","G__60409","G__60410","G__60411","athens.events/prev-block-uid","athens.db/get-block","parent","athens.db/get-parent","deepest-child-prev-sibling","athens.db/deepest-child-block","p__60412","vec__60413","p__60416","vec__60417","athens.events/next-sibling-block","G__60420","G__60421","G__60422","athens.events/next-sibling-block-recursively","sib","or__4185__auto__","athens.events/next-block-uid","athens.db/sort-block-children","ch","next-block-recursive","cljs.core/first","p__60423","vec__60424","p__60427","vec__60428","athens.events/backspace","value","map__60431","reindex","prev-block-uid-","prev-block-string","and__4174__auto__","p__60433","vec__60434","athens.events/split-block","val","index","state","head","cljs.core.subs.cljs$core$IFn$_invoke$arity$3","tail","cljs.core.subs.cljs$core$IFn$_invoke$arity$2","new-uid","new-block","cljs.core.concat.cljs$core$IFn$_invoke$arity$2","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","athens.events/bump-up","athens.events/new-block","athens.events/enter","root-block?","cljs.core/boolean","cljs.core/empty?","p__60437","vec__60438","athens.events/indent","older-sib","p1__60441#","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/count","reindex-blocks","p__60442","vec__60443","athens.events/unindent","context-root-uid","grandpa","reindex-grandpa","p__60446","p__60447","map__60448","vec__60449","athens.events/target-child","source","source-parent","target","new-source-block","new-parent-children","new-target-children","athens.events/between","s","t","x","athens.events/target-sibling-same-parent","s-order","t-order","inc-or-dec","cljs.core/dec","G__60453","G__60454","G__60455","G__60456","G__60457","G__60458","G__60459","athens.events/diff-parent","target-parent","source-parent-children","G__60460","G__60461","G__60462","G__60463","G__60464","target-parent-children","athens.events/drop-bullet","source-uid","target-uid","kind","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","p__60465","vec__60466","e60469","p__60470","vec__60471"],"sourcesContent":["(ns athens.events\n  (:require\n    [athens.db :as db]\n    [athens.util :refer [now-ts gen-block-uid]]\n    [datascript.core :as d]\n    [datascript.transit :as dt]\n    [day8.re-frame.async-flow-fx]\n    [day8.re-frame.tracing :refer-macros [fn-traced]]\n    [re-frame.core :refer [reg-event-db reg-event-fx inject-cofx]]))\n\n\n;; -- re-frame app-db events ---------------------------------------------\n\n(reg-event-db\n  :init-rfdb\n  (fn-traced [_ _]\n             db/rfdb))\n\n\n(reg-event-db\n  :athena/toggle\n  (fn [db _]\n    (update db :athena/open not)))\n\n\n(reg-event-db\n  :athena/update-recent-items\n  (fn-traced [db [_ selected-page]]\n             (when (nil? ((set (:athena/recent-items db)) selected-page))\n               (update db :athena/recent-items conj selected-page))))\n\n\n(reg-event-db\n  :devtool/toggle\n  (fn [db _]\n    (update db :devtool/open not)))\n\n\n(reg-event-db\n  :left-sidebar/toggle\n  (fn [db _]\n    (update db :left-sidebar/open not)))\n\n\n(reg-event-db\n  :right-sidebar/toggle\n  (fn [db _]\n    (update db :right-sidebar/open not)))\n\n\n(reg-event-db\n  :right-sidebar/toggle-item\n  (fn [db [_ item]]\n    (update-in db [:right-sidebar/items item :open] not)))\n\n\n;; TODO: dec all indices > closed item\n(reg-event-db\n  :right-sidebar/close-item\n  (fn [db [_ uid]]\n    (update db :right-sidebar/items dissoc uid)))\n\n\n;; TODO: change right sidebar items from map to datascript\n(reg-event-fx\n  :right-sidebar/open-item\n  (fn-traced [{:keys [db]} [_ uid]]\n             (let [block     (d/pull @db/dsdb '[:node/title :block/string] [:block/uid uid])\n                   new-item  (merge block {:open true :index -1})\n                   new-items (assoc (:right-sidebar/items db) uid new-item)\n                   inc-items (reduce-kv (fn [m k v] (assoc m k (update v :index inc)))\n                                        {}\n                                        new-items)\n                   sorted-items (into (sorted-map-by (fn [k1 k2]\n                                                       (compare\n                                                         [(get-in new-items [k1 :index]) k2]\n                                                         [(get-in new-items [k2 :index]) k1]))) inc-items)]\n               {:db (assoc db :right-sidebar/items sorted-items)\n                :dispatch (when (false? (:right-sidebar/open db))\n                            [:right-sidebar/toggle])})))\n\n\n(reg-event-db\n  :dragging-global/toggle\n  (fn [db _]\n    (update db :dragging-global not)))\n\n\n;; Alerts\n\n(reg-event-db\n  :alert/set\n  (fn-traced [db alert]\n             (assoc db :alert alert)))\n\n\n(reg-event-db\n  :alert/unset\n  (fn-traced [db]\n             (assoc db :alert nil)))\n\n\n;; Loading\n\n(reg-event-db\n  :loading/set\n  (fn-traced [db]\n             (assoc-in db [:loading?] true)))\n\n\n(reg-event-db\n  :loading/unset\n  (fn-traced [db]\n             (assoc-in db [:loading?] false)))\n\n\n;; Block Events\n;; TODO: refactor to an effect\n(defn focus-el\n  [id]\n  (fn []\n    (if-let [el (.. js/document (getElementById id))]\n      (.focus el))))\n\n\n(reg-event-db\n  :editing/uid\n  (fn-traced [db [_ uid]]\n             (js/setTimeout (focus-el (str \"editable-uid-\" uid)) 300)\n             (assoc db :editing/uid uid)))\n\n\n(reg-event-db\n  :tooltip/uid\n  (fn [db [_ uid]]\n    (assoc db :tooltip/uid uid)))\n\n\n;; Daily Notes\n\n(reg-event-db\n  :daily-notes/reset\n  (fn [db _]\n    (assoc db :daily-notes/items [])))\n\n\n;; TODO: don't use app-db, use dsdb\n(reg-event-fx\n  :daily-note/next\n  (fn [{:keys [db]} [_ {:keys [uid title]}]]\n    (let [new-db (update db :daily-notes/items conj uid)]\n      (if (db/e-by-av :block/uid uid)\n        {:db new-db}\n        {:db        new-db\n         :dispatch [:page/create title uid]}))))\n\n\n;; -- event-fx and Datascript Transactions -------------------------------\n\n;; Import/Export\n\n(reg-event-fx\n  :get-db/init\n  (fn [{rfdb :db} _]\n    {:db (-> db/rfdb\n             (assoc :loading? true))\n     :async-flow {:first-dispatch (if false\n                                    [:local-storage/get-db]\n                                    [:http/get-db])\n                  :rules          [{:when :seen?\n                                    :events :reset-conn\n                                    :dispatch-n [[:loading/unset]\n                                                 [:navigate (-> rfdb :current-route :data :name)]]\n                                    :halt? true}]}}))\n\n\n(reg-event-fx\n  :http/get-db\n  (fn [_ _]\n    {:http {:method :get\n            :url db/athens-url\n            :opts {:with-credentials? false}\n            :on-success [:http-success/get-db]\n            :on-failure [:alert/set]}}))\n\n\n(reg-event-fx\n  :http-success/get-db\n  (fn [_ [_ json-str]]\n    (let [datoms (db/str-to-db-tx json-str)\n          new-db (d/db-with (d/empty-db db/schema) datoms)]\n      {:dispatch-n [[:reset-conn new-db]\n                    [:local-storage/set-db new-db]]})))\n\n\n(reg-event-fx\n  :local-storage/get-db\n  [(inject-cofx :local-storage \"datascript/DB\")]\n  (fn [{:keys [local-storage]} _]\n    {:dispatch [:reset-conn (dt/read-transit-str local-storage)]}))\n\n\n(reg-event-fx\n  :local-storage/set-db\n  (fn [_ [_ db]]\n    {:local-storage/set-db! db}))\n\n\n;; Datascript\n\n(reg-event-fx\n  :transact\n  (fn [_ [_ datoms]]\n    {:transact! datoms}))\n\n\n(reg-event-fx\n  :reset-conn\n  (fn [_ [_ db]]\n    {:reset-conn! db}))\n\n\n(reg-event-fx\n  :page/create\n  (fn [_ [_ title uid]]\n    (let [now (now-ts)\n          child-uid (gen-block-uid)\n          child {:db/id -2 :create/time now :edit/time now :block/uid child-uid :block/order 0 :block/open true :block/string \"\"}]\n      {:transact! [{:db/id -1 :node/title title :block/uid uid :create/time now :edit/time now :block/children [child]}]\n       :dispatch [:editing/uid child-uid]})))\n\n\n(reg-event-fx\n  :undo\n  (fn [_ _]\n    (when-let [prev (db/find-prev @db/history #(identical? @db/dsdb %))]\n      {:reset-conn! prev})))\n\n\n(reg-event-fx\n  :redo\n  (fn [_ _]\n    (when-let [next (db/find-next @db/history #(identical? @db/dsdb %))]\n      {:reset-conn! next})))\n\n\n(def rules\n  '[[(after ?p ?at ?ch ?o)\n     [?p :block/children ?ch]\n     [?ch :block/order ?o]\n     [(> ?o ?at)]]\n    [(inc-after ?p ?at ?ch ?new-o)\n     (after ?p ?at ?ch ?o)\n     [(inc ?o) ?new-o]]\n    [(dec-after ?p ?at ?ch ?new-o)\n     (after ?p ?at ?ch ?o)\n     [(dec ?o) ?new-o]]])\n\n\n;; TODO: should be able to use :keys now: https://github.com/tonsky/datascript/blob/master/docs/queries.md\n(defn map-order\n  [blocks]\n  (map (fn [[id order]] {:db/id id :block/order order}) blocks))\n\n\n(defn inc-after\n  [eid order]\n  (->> (d/q '[:find ?ch ?new-o\n              ;;:keys db/id block/order\n              :in $ % ?p ?at\n              :where (inc-after ?p ?at ?ch ?new-o)]\n            @db/dsdb rules eid order)\n       map-order))\n\n\n(defn dec-after\n  [eid order]\n  (->> (d/q '[:find ?ch ?new-o\n              :in $ % ?p ?at\n              :where (dec-after ?p ?at ?ch ?new-o)]\n            @db/dsdb rules eid order)\n       map-order))\n\n\n;; xxx 2 kinds of operations\n;; write operations, it's nice to have entire block and entire parent block to make TXes\n;; read operations (navigation), only need uids\n\n;; xxx these all assume all blocks are open. have to skip closed blocks\n;; TODO: focus AND set selection-start for :editing/uid\n\n(defn prev-sibling-uid\n  [uid]\n  (d/q '[:find ?sib-uid .\n         :in $ ?block-uid\n         :where\n         [?block :block/uid ?block-uid]\n         [?block :block/order ?block-o]\n         [?parent :block/children ?block]\n         [?parent :block/children ?sib]\n         [?sib :block/order ?sib-o]\n         [?sib :block/uid ?sib-uid]\n         [(dec ?block-o) ?prev-sib-o]\n         [(= ?sib-o ?prev-sib-o)]]\n       @db/dsdb uid))\n\n;; if order 0, go to parent\n;; if order n, go to prev siblings deepest child\n(defn prev-block-uid\n  [uid]\n  (let [block (db/get-block [:block/uid uid])\n        parent (db/get-parent [:block/uid uid])\n        deepest-child-prev-sibling (db/deepest-child-block [:block/uid (prev-sibling-uid uid)])]\n    (if (zero? (:block/order block))\n      (:block/uid parent)\n      (:block/uid deepest-child-prev-sibling))))\n\n\n(reg-event-fx\n  :up\n  (fn [_ [_ uid]]\n    {:dispatch [:editing/uid (prev-block-uid uid)]}))\n\n\n(reg-event-fx\n  :left\n  (fn [_ [_ uid]]\n    {:dispatch [:editing/uid (prev-block-uid uid)]}))\n\n\n(defn next-sibling-block\n  [uid]\n  (d/q '[:find (pull ?sib [*]) .\n         :in $ ?block-uid\n         :where\n         [?block :block/uid ?block-uid]\n         [?block :block/order ?block-o]\n         [?parent :block/children ?block]\n         [?parent :block/children ?sib]\n         [?sib :block/order ?sib-o]\n         [?sib :block/uid ?sib-uid]\n         [(inc ?block-o) ?prev-sib-o]\n         [(= ?sib-o ?prev-sib-o)]]\n       @db/dsdb uid))\n\n\n(defn next-sibling-block-recursively\n  [uid]\n  (loop [uid uid]\n    (let [sib (next-sibling-block uid)\n          parent (db/get-parent [:block/uid uid])]\n      (if (or sib (:node/title parent))\n        sib\n        (recur (:block/uid parent))))))\n\n;; if child, go to child 0\n;; else recursively find next sibling of parent\n(defn next-block-uid\n  [uid]\n  (let [block (->> (db/get-block [:block/uid uid])\n                   db/sort-block-children)\n        ch (:block/children block)\n        next-block-recursive (next-sibling-block-recursively uid)]\n    (cond\n      ch (:block/uid (first ch))\n      next-block-recursive (:block/uid next-block-recursive))))\n\n\n(reg-event-fx\n  :down\n  (fn [_ [_ uid]]\n    {:dispatch [:editing/uid (next-block-uid uid)]}))\n\n\n(reg-event-fx\n  :right\n  (fn [_ [_ uid]]\n    {:dispatch [:editing/uid (next-block-uid uid)]}))\n\n\n;; no-op if root 0th child\n;; otherwise delete block and join with previous block\n(defn backspace\n  [uid value]\n  (let [block (db/get-block [:block/uid uid])\n        parent (db/get-parent [:block/uid uid])\n        reindex (dec-after (:db/id parent) (:block/order block))\n        prev-block-uid- (prev-block-uid uid)\n        {prev-block-string :block/string} (db/get-block [:block/uid prev-block-uid-])]\n    (cond\n      (and (:node/title parent) (zero? (:block/order block))) nil\n      (:block/children block) nil\n      :else {:dispatch-later [{:ms 0 :dispatch [:transact [[:db/retractEntity [:block/uid uid]]\n                                                           [:db/add [:block/uid prev-block-uid-] :block/string (str prev-block-string value)]\n                                                           {:db/id (:db/id parent) :block/children reindex}]]}\n                              {:ms 10 :dispatch [:editing/uid prev-block-uid-]}]})))\n\n\n(reg-event-fx\n  :backspace\n  (fn [_ [_ uid value]]\n    (backspace uid value)))\n\n\n(defn split-block\n  [uid val index state]\n  (let [parent (db/get-parent [:block/uid uid])\n        block (db/get-block [:block/uid uid])\n        head (subs val 0 index)\n        tail (subs val index)\n        new-uid (gen-block-uid)\n        new-block {:db/id        -1\n                   :block/order  (inc (:block/order block))\n                   :block/uid    new-uid\n                   :block/open   true\n                   :block/string tail}\n        reindex (->> (inc-after (:db/id parent) (:block/order block))\n                     (concat [new-block]))]\n    (swap! state assoc :atom-string head) ;; FIXME: bad vibes - but easiest solution right now\n    {:transact! [[:db/add (:db/id block) :block/string head]\n                 {:db/id (:db/id parent)\n                  :block/children reindex}]\n     :dispatch  [:editing/uid new-uid]}))\n\n\n(defn bump-up\n  \"If user presses enter at the start of non-empty string, push that block down and\n  and start editing a new block in the position of originating block - 'bump up' \"\n  [uid]\n  (let [parent (db/get-parent [:block/uid uid])\n        block (db/get-block [:block/uid uid])\n        new-uid (gen-block-uid)\n        new-block {:db/id        -1\n                   :block/order  (:block/order block)\n                   :block/uid    new-uid\n                   :block/open   true\n                   :block/string \"\"}\n        reindex (->> (inc-after (:db/id parent) (dec (:block/order block)))\n                     (concat [new-block]))]\n    {:transact! [{:db/id (:db/id parent) :block/children reindex :block/string \"\"}]\n     :dispatch [:editing/uid new-uid]}))\n\n\n(defn new-block\n  \"Add a new-block after block\"\n  [block parent]\n  (let [new-uid   (gen-block-uid)\n        new-block {:block/order  (inc (:block/order block))\n                   :block/uid    new-uid\n                   :block/open   true\n                   :block/string \"\"}\n        reindex (->> (inc-after (:db/id parent) (:block/order block))\n                     (concat [new-block]))]\n    {:dispatch-n [[:transact [{:db/id          [:block/uid (:block/uid parent)]\n                               :block/children reindex}]]\n                  [:editing/uid new-uid]]}))\n\n\n(defn enter\n  [uid val index state]\n  (let [block       (db/get-block [:block/uid uid])\n        parent      (db/get-parent [:block/uid uid])\n        root-block? (boolean (:node/title parent))]\n    (cond\n      (not (zero? index)) (split-block uid val index state)\n      (and (empty? val) root-block?) (new-block block parent)\n      (empty? val) {:dispatch [:unindent uid]}\n      (and (zero? index) val) (bump-up uid))))\n\n\n(reg-event-fx\n  :enter\n  (fn [_ [_ uid val index state]]\n    (enter uid val index state)))\n\n\n(defn indent\n  [uid]\n  (let [block (db/get-block [:block/uid uid])\n        parent (db/get-parent [:block/uid uid])\n        older-sib (->> parent\n                       :block/children\n                       (filter #(= (dec (:block/order block)) (:block/order %)))\n                       first\n                       :db/id\n                       db/get-block)\n        new-block {:db/id (:db/id block) :block/order (count (:block/children older-sib))}\n        reindex-blocks (->> (dec-after (:db/id parent) (:block/order block)))]\n    {:transact! [[:db/retract (:db/id parent) :block/children (:db/id block)]\n                 {:db/id (:db/id older-sib) :block/children [new-block]} ;; becomes child of older sibling block \u2014 same parent but order-1\n                 {:db/id (:db/id parent) :block/children reindex-blocks}]}))\n\n\n(reg-event-fx\n  :indent\n  (fn [_ [_ uid]]\n    (indent uid)))\n\n\n(defn unindent\n  [uid context-root-uid]\n  (let [parent (db/get-parent [:block/uid uid])\n        grandpa (db/get-parent (:db/id parent))\n        new-block {:block/uid uid :block/order (inc (:block/order parent))}\n        reindex-grandpa (->> (inc-after (:db/id grandpa) (:block/order parent))\n                             (concat [new-block]))]\n    ;; if parent is context-root or has node/title, no-op\n    (when-not (or (:node/title parent) (= (:block/uid parent) context-root-uid))\n      {:transact! [[:db/retract (:db/id parent) :block/children [:block/uid uid]]\n                   {:db/id (:db/id grandpa) :block/children reindex-grandpa}]})))\n\n\n(reg-event-fx\n  :unindent\n  (fn [{rfdb :db} [_ uid]]\n    (let [context-root-uid (get-in rfdb [:current-route :path-params :id])]\n      (unindent uid context-root-uid))))\n\n\n(defn target-child\n  [source source-parent target]\n  (let [new-source-block {:block/uid (:block/uid source) :block/order 0}\n        new-parent-children (->> (dec-after (:db/id source-parent) (:block/order source)))\n        new-target-children (->> (inc-after (:dbid target) (dec 0))\n                                 (concat [new-source-block]))]\n    [[:db/retract (:db/id source-parent) :block/children [:block/uid (:block/uid source)]] ;; retract source from parent\n     {:db/add (:db/id source-parent) :block/children new-parent-children} ;; reindex parent without source\n     {:db/id (:db/id target) :block/children new-target-children}])) ;; reindex target. include source\n\n\n(defn between\n  \"http://blog.jenkster.com/2013/11/clojure-less-than-greater-than-tip.html\"\n  [s t x]\n  (if (< s t)\n    (and (< s x) (< x t))\n    (and (< t x) (< x s))))\n\n\n(defn target-sibling-same-parent\n  \"Give source block target block's order\n    When source is below target, increment block orders between source and target-1\n    When source is above target, decrement block order between...\";; TODO\n\n  [source target parent]\n  (let [s-order (:block/order source)\n        t-order (:block/order target)]\n    (if (= s-order (dec t-order))\n      nil\n      (let [new-source-block {:db/id (:db/id source) :block/order t-order}\n            inc-or-dec       (if (> s-order t-order) inc dec)\n            reindex          (->> (d/q '[:find ?ch ?new-order\n                                         :in $ ?parent ?s-order ?t-order ?between ?inc-or-dec\n                                         :where\n                                         [?parent :block/children ?ch]\n                                         [?ch :block/order ?order]\n                                         [(?between ?s-order ?t-order ?order)]\n                                         [(?inc-or-dec ?order) ?new-order]]\n                                       @db/dsdb (:db/id parent) s-order (dec t-order) between inc-or-dec)\n                                  map-order\n                                  (concat [new-source-block]))]\n        [{:db/add (:db/id parent) :block/children reindex}]))))\n\n\n(defn diff-parent\n  [source target source-parent target-parent]\n  (let [new-block              {:db/id (:db/id source) :block/order (:block/order target)}\n        source-parent-children (->> (d/q '[:find ?ch ?new-order\n                                           :in $ % ?parent ?source-order\n                                           :where (dec-after ?parent ?source-order ?ch ?new-order)]\n                                         @db/dsdb rules (:db/id source-parent) (:block/order source))\n                                    map-order)\n        target-parent-children (->> (inc-after (:db/id target-parent) (dec (:block/order target)))\n                                    (concat [new-block]))]\n    [[:db/retract (:db/id source-parent) :block/children (:db/id source)]\n     ;; reindex source\n     {:db/id (:db/id source-parent) :block/children source-parent-children}\n     ;; reindex target\n     {:db/id (:db/id target-parent) :block/children target-parent-children}]))\n\n\n(defn drop-bullet\n  [source-uid target-uid kind]\n  (let [source        (db/get-block [:block/uid source-uid])\n        target        (db/get-block [:block/uid target-uid])\n        source-parent (db/get-parent [:block/uid source-uid])\n        target-parent (db/get-parent [:block/uid target-uid])]\n    {:transact!\n     (cond\n       ;; child always has same behavior: move to 0th child of target\n       (= kind :child) (target-child source source-parent target)\n       ;; re-order blocks between source and target\n       (= source-parent target-parent) (target-sibling-same-parent source target source-parent)\n       ;;; when parent is different, re-index both source-parent and target-parent\n       (not= source-parent target-parent) (diff-parent source target source-parent target-parent))}))\n\n\n(reg-event-fx\n  :drop-bullet\n  (fn-traced [_ [_ source-uid target-uid kind]]\n             (drop-bullet source-uid target-uid kind)))\n\n;;;; TODO: delete the following logic when re-implementing title merge\n\n;;(defn node-with-title\n;;  [ds title]\n;;  (d/q '[:find ?e .\n;;         :in $ ?title\n;;         :where [?e :node/title ?title]]\n;;       ds title))\n;;\n;;\n;;(defn referencing-blocks\n;;  [ds title]\n;;  (d/q '[:find ?e ?s\n;;         :in $ ?regex\n;;         :where\n;;         [?e :block/string ?s]\n;;         [(re-find ?regex ?s)]]\n;;       ds (patterns/linked title)))\n;;\n;;\n;;(defn rename-refs-tx\n;;  [old-title new-title [eid s]]\n;;  (let [new-s (str/replace\n;;                s\n;;                (patterns/linked old-title)\n;;                (str \"$1$3$4\" new-title \"$2$5\"))]\n;;    [:db/add eid :block/string new-s]))\n;;\n;;\n;;(defn rename-tx\n;;  [ds old-title new-title]\n;;  (let [eid (node-with-title ds old-title)\n;;        blocks (referencing-blocks ds old-title)]\n;;    (->> blocks\n;;         (map (partial rename-refs-tx old-title new-title))\n;;         (into [[:db/add eid :node/title new-title]]))))\n;;\n;;\n;;(reg-event-fx\n;;  :node/renamed\n;;  [(rp/inject-cofx :ds)]\n;;  (fn-traced [{:keys [db ds]} [_ old-title new-title]]\n;;             (when (not= old-title new-title)\n;;               (if (node-with-title ds new-title)\n;;                 {:db (assoc db :merge-prompt {:active true\n;;                                               :old-title old-title\n;;                                               :new-title new-title})\n;;                  :timeout {:action :start\n;;                            :id :merge-prompt\n;;                            :wait 7000\n;;                            :event [:node/merge-canceled]}}\n;;                 {:transact (rename-tx ds old-title new-title)}))))\n;;\n;;\n;;(defn count-children\n;;  [ds title]\n;;  (d/q '[:find (count ?children) .\n;;         :in $ ?title\n;;         :where [?e :node/title ?title]\n;;         [?e :block/children ?children]]\n;;       ds title))\n;;\n;;\n;;(defn get-children-eids\n;;  [ds title]\n;;  (d/q '[:find [?children ...]\n;;         :in $ ?title\n;;         :where [?e :node/title ?title]\n;;         [?e :block/children ?children]]\n;;       ds title))\n;;\n;;\n;;(defn move-blocks-tx\n;;  [ds from-title to-title]\n;;  (let [block-count (count-children ds to-title)\n;;        block-eids (get-children-eids ds from-title)]\n;;    (mapcat (fn [eid]\n;;              (let [order (:block/order (d/pull ds [:block/order] eid))]\n;;                [[:db/add [:node/title to-title] :block/children eid]\n;;                 [:db/add eid :block/order (+ order block-count)]]))\n;;            block-eids)))\n;;\n;;\n;;(reg-event-fx\n;;  :node/merged\n;;  [(rp/inject-cofx :ds)]\n;;  (fn-traced [{:keys [db ds]} [_ primary-title secondary-title]]\n;;             {:db (dissoc db :merge-prompt)\n;;              :timeout {:action :clear\n;;                        :id :merge-prompt}\n;;              :transact (concat [[:db.fn/retractEntity [:node/title secondary-title]]]\n;;                                (move-blocks-tx ds secondary-title primary-title)\n;;                                (rename-tx ds primary-title secondary-title))}))\n;;\n;;\n;;(reg-event-fx\n;;  :node/merge-canceled\n;;  (fn-traced [{:keys [db]} _]\n;;             {:db (dissoc db :merge-prompt)\n;;              :timeout {:action :clear\n;;                        :id :merge-prompt}}))\n\n"]}